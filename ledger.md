## Ledger Design Document

Subspace Ledger is an immutable, append-only log of batched transactions, or blockchain, that manages the transfer of subspace credits between clients, hosts, and farmers on the subspace network in a fully decentralized manner.

Hosts pledge space to the network by generating a proof of space, and encoding this as a ledger pledge tx. This tx must specify the size and duration of the pledge, typically 10 GB for 1 month. 

Clients reserve space by generating a contract tx which transfers credits they own to the subspace nexus address. This tx must specify the duration and size of the contract, in GB per month. The contract cost is a function of the Cost of Storage published in the last block and the space-time reserved.

Farmers validate pledge tx from hosts and contract tx from clients before adding them to the mempool and gossiping to neighbors. Each proposed block will include all valid pledge and contract tx. For each block the farmers will compute the cost of storage by aggregating all valid host pledges and client reservations to determine the current space available on the network. The cost of storage is simply the ratio between the current supply of subspace credits and the total space available, computed as credits per byte-second, which can be translated to credits per GB-Month.

Once a pledge tx is published the corresponding host may join the host network and begin serving database tx requests for clients. Hosts are incentivized to remain online through their pledge period in order to accumulate uptime. All hosts keep a copy of the Tracker, an eventually-consistent in-memory data structure updated through signed gossip, that that records the uptime of each host with a valid pledge. At the end of a pledge interval the host will generate a payment tx referencing their pledge, uptime, the average cost of storage over their pledge interval, and claim against some fraction of the nexus balance based on their relative storage pledged to the network, as a fraction of all storage pledged.. Farmers will validate these payment requests, by referencing the tracker,  and include them in the next block as a nexus tx. This tx will transfer credits locked in the nexus address to the hostâ€™s address. 

Once a contract tx is published the corresponding client may submit valid database tx requests to hosts. If a host does not fulfill a valid database tx request for a contract shard that they are responsible for, or provides an invalid response, the client may submit a proof of fault to the host network. If the fault is validate the hosts uptime will be decremented accordingly. Repeated faults will result in the host being temporarily blacklisted from the host network. Clients who submit invalid proofs will see their storage contracts reduced with repeated offenses leading to contract invalidation. 

It is important to understand that clients do not pay hosts directly for storage. Instead they pay the network through the intermediary of the nexus address. Credits locked within the nexus address may only be transferred by farmers on behalf of hosts who provide a valid payment request. 

Client storage contracts may be of two basic types: mutable and immutable. A mutable storage contract temporarily reserves some amount of space on the network. Records stored against a mutable contract may be updated or deleted at any time by the client. If a contract is not renewed, records will be dropped by hosts at the end of the contract period. An immutable storage contract permanently reserves some amount of space on the network. Once written, 
records stored against an immutable contract may not be updated or deleted. These records will remain on the network as long as the network exists.

Accordingly, the Cost of Storage will vary between mutable and immutable contracts, for any given block. The cost of reserving mutable space and the method for paying hosts from the nexus address works as described above and is considered the default pattern. 

The cost of reserving immutable space is derived from the cost of mutable space by applying a multiplier of the ratio between the amount of mutable space reserved and the amount of immutable space reserved. The default multiplier is 1, and it will increase polynomially as more immutable storage is reserved. If the fraction of immutable space reserved to mutable space reserved is 10%, then the multiplier is 10, 50% yields 50x, 200% yields 200x and so on. This allows the cost to be adjust internally based on supply and demand.

 When hosts request payment at the end of their pledge interval they will compute the average cost of immutable storage over the pledge interval and make claim to a constant % of that cost based on their relative pledge size. A percentage set at two points will distributed 99% of the contract payment over 20 years. Considering that the relative value of subspace credits (in fiat) is expected to rise over time, payouts to hosts could be valuable for considerably longer.

The ability to store immutable data on the subspace network has an interesting application. It allows for the subspace credit ledger itself to be stored as a collection of immutable records on SSDB. Each block can be stored in abbreviated form, containing only the block header and a list of all txs included in the block. Each tx itself would also be stored as a separate immutable record on SSDB. The full block could then be constructed by querying SSDB for the appropriate records. 

When a farmer computes the best solution and publishes a new block they will also create a corresponding immutable storage contract for the block and its txs, which will be included in the block as well. The cost of this contract will be covered by a portion of the block reward, which will be dynamic based on the cost of storage of the block, allowing the farmer to receive a constant reward. The block header and each tx will then be stored as immutable records on SSDB against this immutable storage contract. 

If ledger txs are canonically signed they cannot be malleated and may be considered fully immutable. Since txs are already gossiped between nodes and held in the mempool of each farmer if valid, they do not need to be gossiped with the new block. This means the apparent block size is a tiny fraction of the full block, as it consists of a 400 byte header and a list of 32 byte tx ids. This allows for the block to hold up 30,000 tx and still be less than 1 MB, remaining well within the security constraints of the ten minute block propagation time needed to prevent excessive chain forks. This is roughly a 10x improvement over the throughput of a blockchain like Bitcoin or Ethereum, with the same levels of decentralization and security. Moreover, the size of the individual txs have no effect on throughput since they are all referenced by their 32 byte hash.

In theory, if the subspace ledger can be stored on SSDB, then any blockchain could be stored on SSDB as well. Initially this could be used as a secure backup for existing blockchains but it could eventually be used as the basis for new blockchains, which would leverage the existing subspace network to bootstrap their own chain in a secure and decentralized manner. Subspace could become a generic data abstraction framework for all blockchains or any immutable distributed ledger data structure such as hashgraph, blockdag or tangle. 

